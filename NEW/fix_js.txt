<script>
(function() {
    var footer = document.querySelector('.mobile-fix-footer');
    var layerBtn = document.querySelector('.jsLayerBtn');
    var closeBtn = document.querySelector('.jsFixClose');
    var closeBg = document.querySelector('.fix-layer-close-bg');
    var mobileLayerBg = document.querySelector('.jsMobileLayerBG');

    if (!footer) return;

    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    var scrollPos = 0;
    var ticking = false;

    footer.style.opacity = '0';
    footer.style.pointerEvents = 'none';
    footer.style.visibility = 'hidden';
    footer.style.transition = 'opacity 0.2s ease';

    if (layerBtn) {
        layerBtn.addEventListener('click', function() {
            setTimeout(function() {
                var mobileLayer = document.querySelector('.jsMobileLayer');
                if (mobileLayer && mobileLayer.classList.contains('fixed')) {
                    footer.style.opacity = '0';
                    footer.style.pointerEvents = 'none';
                    footer.style.visibility = 'hidden';

                    if (isIOS) {
                        scrollPos = window.pageYOffset || document.documentElement.scrollTop;
                        document.body.style.position = 'fixed';
                        document.body.style.top = -scrollPos + 'px';
                        document.body.style.left = '0';
                        document.body.style.right = '0';
                    }
                }
            }, 300);
        });
    }

    function showIfScrolled() {
        var mobileLayer = document.querySelector('.jsMobileLayer');
        if (mobileLayer && mobileLayer.classList.contains('fixed')) {
            return;
        }

        var scrollY = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollY > 800) {
            if (footer.style.visibility !== 'visible') {
                footer.style.opacity = '1';
                footer.style.pointerEvents = 'auto';
                footer.style.visibility = 'visible';
            }
        } else {
            if (footer.style.visibility !== 'hidden') {
                footer.style.opacity = '0';
                footer.style.pointerEvents = 'none';
                footer.style.visibility = 'hidden';
            }
        }
    }

    function closeLayer() {
        if (isIOS && document.body.style.position === 'fixed') {
            document.body.style.position = '';
            document.body.style.top = '';
            document.body.style.left = '';
            document.body.style.right = '';
            window.scrollTo(0, scrollPos);
        }
        showIfScrolled();
    }

    if (closeBtn) closeBtn.addEventListener('click', closeLayer);
    if (closeBg) closeBg.addEventListener('click', closeLayer);
    if (mobileLayerBg) mobileLayerBg.addEventListener('click', closeLayer);

    window.addEventListener('scroll', function() {
        if (!ticking) {
            window.requestAnimationFrame(function() {
                showIfScrolled();
                ticking = false;
            });
            ticking = true;
        }
    }, { passive: true });

    showIfScrolled();
})();
</script>
